<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>River Points 원화 계산기</title>
  <style>
    :root{--bg:#0f141a;--panel:#151b23;--text:#e6edf3;--muted:#9aa7b3;--accent:#4da3ff}
    *{box-sizing:border-box;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
    body{margin:0;background:var(--bg);color:var(--text)}
    .wrap{max-width:960px;margin:32px auto;padding:0 20px}
    .card{background:var(--panel);border:1px solid #1f2937;border-radius:16px;padding:20px;margin-bottom:16px}
    h1{font-size:24px;margin:0 0 8px}
    .muted{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="number"],input[type="text"]{width:100%;padding:12px;border-radius:12px;border:1px solid #2b3441;background:#0d1218;color:var(--text)}
    input[type="range"]{width:100%}
    button{background:var(--accent);color:#031225;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;transition:0.2s}
    button:hover{opacity:0.9}
    button.ghost{background:transparent;border:1px solid #334155;color:var(--text)}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
    .kpi .box{background:#0d1218;border:1px solid #1f2937;border-radius:12px;padding:14px}
    .kpi .val{font-size:18px;font-weight:800}
    .big{font-size:28px;font-weight:900}
    @media (max-width:760px){.grid,.grid-3,.kpi{grid-template-columns:1fr}}
    .chart-toggle{display:flex;gap:8px;margin-bottom:12px}
    .chart-toggle button{flex:1;background:#1d2632;border:1px solid #2b3441;color:var(--muted)}
    .chart-toggle button.active{background:var(--accent);color:#001425;font-weight:700}
    iframe{width:100%;height:480px;border:0;border-radius:12px}
  </style>
</head>
<body>
<div class="wrap">
  <h1>River Points 원화 계산기</h1>
  <p class="muted">
    계산식: <code>KRW = RiverPoints × ConversionRate(일) × (River/USDT) × (KRW/USDT)</code><br>
    실시간 시세는 리버와 테더 각각 Bitget, Upbit의 API를 이용했습니다.<br>
    $RIVER와 $River Pts 의 정보는 모두 PancakeSwap 기준입니다.
  </p>

  <!-- 수익 계산기 -->
  <div class="card">
    <div class="grid">
      <div>
        <label>보유한 River Points</label>
        <input id="points" type="number" min="0" step="0.0001" placeholder="예) 10000" />
      </div>
      <div>
        <label>스테이킹 일수 (0~180)</label>
        <input id="days" type="range" min="0" max="180" value="0" step="1" />
        <div class="muted">선택: <span id="daysOut">0</span>일 · Conversion Rate: <span id="rateOut">0.0000000</span> · vs Day1: <span id="vs1x">0x</span></div>
      </div>
    </div>

    <div class="grid-3" style="margin-top:12px">
      <div>
        <label>$River/USDT (Bitget 실시간)</label>
        <input id="riverUsdt" type="text" placeholder="예: 0.1234" />
        <div class="muted" id="riverUsdtOut">-</div>
      </div>
      <div>
        <label>KRW/USDT (Upbit 실시간)</label>
        <input id="krwUsdt" type="text" placeholder="예: 1350" />
        <div class="muted" id="krwUsdtOut">-</div>
      </div>
      <div>
        <label>데이터</label>
        <button id="refreshBtn">실시간 가격 불러오기</button>
        <button class="ghost" id="clearBtn">초기화</button>
        <div class="muted" id="lastUpdated">마지막 업데이트: -</div>
      </div>
    </div>

    <div class="kpi">
      <div class="box"><div class="muted">예상 수익(USDT)</div><div class="val" id="usdtOut">-</div></div>
      <div class="box"><div class="muted">예상 수익(KRW)</div><div class="big" id="krwOut">-</div></div>
      <div class="box"><div class="muted">Day1 기준 배수</div><div class="val" id="ratioOut">-</div></div>
    </div>
  </div>

  <!-- DexScreener 차트 -->
  <div class="card">
    <div class="chart-toggle">
      <button id="riverBtn" class="active">RIVER / USDT</button>
      <button id="rptsBtn">River Pts / USDT </button>
    </div>
    <div id="chartContainer">
      <iframe id="chartFrame" src="https://dexscreener.com/bsc/0xda7ad9dea9397cffddae2f8a052b82f1484252b3?embed=1&theme=dark"></iframe>
    </div>
  </div>

  <p class="muted">River Points Calculator — 2025 Vision </p>
</div>

<script>
  const BITGET_URL = "https://api.bitget.com/api/v2/spot/market/tickers?symbol=RIVERUSDT";
  const UPBIT_URL = "https://api.upbit.com/v1/ticker?markets=KRW-USDT";

  const $points=document.getElementById('points');
  const $days=document.getElementById('days');
  const $daysOut=document.getElementById('daysOut');
  const $rateOut=document.getElementById('rateOut');
  const $riverUsdt=document.getElementById('riverUsdt');
  const $krwUsdt=document.getElementById('krwUsdt');
  const $riverUsdtOut=document.getElementById('riverUsdtOut');
  const $krwUsdtOut=document.getElementById('krwUsdtOut');
  const $refreshBtn=document.getElementById('refreshBtn');
  const $clearBtn=document.getElementById('clearBtn');
  const $lastUpdated=document.getElementById('lastUpdated');
  const $usdtOut=document.getElementById('usdtOut');
  const $krwOut=document.getElementById('krwOut');
  const $ratioOut=document.getElementById('ratioOut');
  const $vs1x=document.getElementById('vs1x');

  const fmt=(n,d=2)=>isNaN(n)?"-":Number(n).toLocaleString('ko-KR',{maximumFractionDigits:d});
  const nowStr=()=>new Date().toLocaleString('ko-KR');

  function convRate(days){
    const d=Math.max(0,Math.min(180,Number(days)||0));
    if(d===0)return 0;
    if(d<=90)return(d/90)*0.01;
    return 0.01+((d-90)/90)*0.02;
  }
  const DAY1_RATE=convRate(1);

  function recalc(){
    const pts=Number($points.value||0);
    const d=Number($days.value||0);
    const r=convRate(d);
    const riverUsdt=Number($riverUsdt.value);
    const krwUsdt=Number($krwUsdt.value);
    const usdt=pts*r*riverUsdt;
    const krw=usdt*krwUsdt;
    const ratio=DAY1_RATE?(r/DAY1_RATE):0;
    $daysOut.textContent=d.toFixed(0);
    $rateOut.textContent=r.toFixed(6);
    $vs1x.textContent=(ratio?ratio.toFixed(0):0)+"x";
    $usdtOut.textContent=fmt(usdt,4)+" USDT";
    $krwOut.textContent=fmt(krw,0)+" 원";
    $ratioOut.textContent=ratio?ratio.toFixed(0)+"x":"-";
  }

  [$points,$days,$riverUsdt,$krwUsdt].forEach($el=>{
    $el.addEventListener('input',recalc);
    $el.addEventListener('change',recalc);
  });

  async function fetchRiverUsdt(){
    try{
      const j=await fetch(BITGET_URL,{cache:"no-store"}).then(r=>r.json());
      const ticker=j?.data?.[0];
      const price=parseFloat(ticker?.lastPr);
      if(typeof price!=="number"||isNaN(price))throw new Error("가격없음");
      $riverUsdt.value=String(price);
      $riverUsdtOut.textContent=`현재 River/USDT: ${fmt(price,6)} USDT (Bitget)`;
    }catch(e){console.warn(e);$riverUsdtOut.textContent="자동 조회 실패 — 직접 입력";}
  }

  async function fetchKrwPerUsdt(){
    try{
      const j=await fetch(UPBIT_URL,{cache:"no-store"}).then(r=>r.json());
      const price=j?.[0]?.trade_price;
      if(typeof price!=="number")throw new Error("환율없음");
      $krwUsdt.value=String(price);
      $krwUsdtOut.textContent=`현재 KRW/USDT: ${fmt(price,2)} ₩/USDT (Upbit)`;
    }catch(e){console.warn(e);$krwUsdtOut.textContent="자동 조회 실패 — 직접 입력";}
  }

  async function refreshAll(){
    $lastUpdated.textContent="업데이트 중…";
    await Promise.all([fetchRiverUsdt(),fetchKrwPerUsdt()]);
    $lastUpdated.textContent="마지막 업데이트: "+nowStr();
    recalc();
  }

  document.getElementById('refreshBtn').addEventListener('click',refreshAll);
  document.getElementById('clearBtn').addEventListener('click',()=>{
    $points.value="";$days.value=0;$riverUsdt.value="";$krwUsdt.value="";
    $riverUsdtOut.textContent="-";$krwUsdtOut.textContent="-";$lastUpdated.textContent="마지막 업데이트: -";
    recalc();
  });

  const riverBtn=document.getElementById('riverBtn');
  const rptsBtn=document.getElementById('rptsBtn');
  const chartFrame=document.getElementById('chartFrame');

  riverBtn.onclick=()=>{
    riverBtn.classList.add('active');
    rptsBtn.classList.remove('active');
    chartFrame.src="https://dexscreener.com/bsc/0xda7ad9dea9397cffddae2f8a052b82f1484252b3?embed=1&theme=dark";
  };

  rptsBtn.onclick=()=>{
    rptsBtn.classList.add('active');
    riverBtn.classList.remove('active');
    chartFrame.src="https://dexscreener.com/bsc/0xfc6be825925b7a83d131e33b46efef9084f0e014?embed=1&theme=dark";
  };

  refreshAll();
</script>
</body>
</html>
